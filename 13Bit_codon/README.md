ã“ã®ãƒšãƒ¼ã‚¸ã¯ã®çµŒé¨“ã‚’N-Queensã‚’ç ”ç©¶é–‹ç™ºã™ã‚‹ã“ã¨ã®å®Ÿè·µã§å¾—ãŸå¤±æ•—ã¨æˆåŠŸã‚’æ•´ç†çµ±åˆã—Python/codonæ´»ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚ã€ŒCodon ã¨ã¯ä½•ã‹ã€ã€Œãªãœä½¿ã†ã®ã‹ã€ã€Œã©ã®ã‚ˆã†ã«æ§‹ç¯‰ã—ã€é«˜é€ŸåŒ–ã—ã€æˆæœã‚’ä¸Šã’ãŸã®ã‹ã€ã‚’å®Ÿè·µçš„ã«ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚

---

# ğŸ§¬ Codon å®Ÿè·µã‚¬ã‚¤ãƒ‰ â€” Pythonã‚’è¶…ãˆã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©å‹é«˜é€ŸåŒ–ã®é“

**Author:** iichiro suzuki
**Project:** Python / Codon æœ€é©åŒ–ã«ã‚ˆã‚‹ N-Queens ã‚½ãƒ«ãƒãƒ¼é–‹ç™ºè¨˜éŒ²
**Environment:** Fedora 42 / Amazon Linux 2023 / LLVM / PyPy / CUDA
**Keywords:** Codon, LLVM, NVPTX, Constellations, Bitboard, Optimization

---

## ğŸš€ ã¯ã˜ã‚ã«

Python ã¯ç¾ã—ãæŸ”è»Ÿã§ã™ãŒã€æ•°å€¤è¨ˆç®—ã‚„å†å¸°å‡¦ç†ã®ä¸–ç•Œã§ã¯é™ç•ŒãŒã‚ã‚Šã¾ã™ã€‚
**Codon** ã¯ã€Python ã®æ§‹æ–‡ã‚’ãã®ã¾ã¾ã« **LLVM ãƒ™ãƒ¼ã‚¹ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æœ€é©åŒ–** ã‚’å®Ÿç¾ã™ã‚‹æ–°ä¸–ä»£ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã™ã€‚

ç§ã¯ 2025 å¹´ã‚’é€šã—ã¦ã€N-Queens å•é¡Œã¨ã„ã†æ¥µç«¯ã«å†å¸°çš„ãƒ»çµ„åˆã›çš„ãªå•é¡Œã‚’é¡Œæã«ã€
**Python â†’ Codon â†’ GPUï¼ˆCUDAï¼‰** ã¨ã„ã†é“ã‚’å®Ÿè·µçš„ã«æ­©ã¿ã¾ã—ãŸã€‚
ã“ã“ã§ã¯ã€ãã®éç¨‹ã§å¾—ã‚‰ã‚ŒãŸçŸ¥è¦‹ãƒ»æ§‹ç¯‰æ³•ãƒ»ãƒã‚¦ãƒã‚¦ãƒ»é›£æ‰€ãƒ»å“²å­¦ã‚’ã¾ã¨ã‚ã¾ã™ã€‚

> [!TIP]
> çµè«–ã‹ã‚‰è¨€ã„ã¾ã™ã¨ã€GPU/CUDA N-Queensã¨ã€Python/Codon N-Queensã®è¨ˆæ¸¬æ™‚é–“ã«ã»ã¼é•ã„ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸ

GPU/CUDA N-Queens
``` bash
GPU/CUDA
10Bit_CUDA/01CUDA_Bit_Symmetry.cu
19:       4968057848        621012754     000:00:00:13.80
20:      39029188884       4878666808     000:00:02:02.52
21:     314666222712      39333324973     000:00:18:46.52
22:    2691008701644     336376244042     000:03:00:22.54
23:   24233937684440    3029242658210     001:06:03:49.29
```

Python/Codon N-Queens
``` bash
amazon AWS m4.16xlarge x 1
$ codon build -release 15Py_constellations_optimize_codon.py && ./15Py_constellations_optimize_codon
 N:            Total       Unique        hh:mm:ss.ms
 5:               10            0         0:00:00.000
 6:                4            0         0:00:00.079
 7:               40            0         0:00:00.001
 8:               92            0         0:00:00.001
 9:              352            0         0:00:00.001
10:              724            0         0:00:00.002
11:             2680            0         0:00:00.102
12:            14200            0         0:00:00.002
13:            73712            0         0:00:00.005
14:           365596            0         0:00:00.011
15:          2279184            0         0:00:00.035
16:         14772512            0         0:00:00.078
17:         95815104            0         0:00:00.436
18:        666090624            0         0:00:02.961
19:       4968057848            0         0:00:22.049
20:      39029188884            0         0:02:52.430
21:     314666222712            0         0:24:25.554
22:    2691008701644            0         3:29:33.971
23:   24233937684440            0  1  day,8:12:58.977
```

``` bash
top-10:29:32 up 1 day,16:13, 4 users, load average: 64.39,64.21,64.12
Tasks: 563 total,  2 running,561 sleeping,  0 stopped,  0 zombie
%Cpu(s):100.0 us, 0.0 sy, 0.0 ni, 0.0 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st
MiB Mem : 257899.4 total,256193.4 free,  1225.5 used,   480.5 buff/cache
MiB Swap:      0.0 total,     0.0 free,     0.0 used. 255314.6 avail Mem
    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
   5634 suzuki    20   0   13.4g  70056   7384 R  6399   0.0 148411:55 15Py_constellat
```

 ---

## ğŸ§© ç¬¬1ç« ï¼šCodonã¨ã¯ä½•ã‹

Codon ã¯ **LLVM ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æŒã¤ AOTï¼ˆAhead-of-Timeï¼‰Python ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©** ã§ã™ã€‚
ä»¥ä¸‹ã®ç‚¹ã§ä»–ã®æ‰‹æ³•ï¼ˆPyPy, Cythonï¼‰ã¨ã¯ç•°ãªã‚Šã¾ã™ã€‚

| æ‰‹æ³•        | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ–¹å¼       | Pythonäº’æ›æ€§  | ä¸»ãªç‰¹å¾´           |
| --------- | ------------- | ---------- | -------------- |
| CPython   | ã‚¤ãƒ³ã‚¿ãƒ—ãƒªã‚¿        | 100%       | æŸ”è»Ÿã ãŒé…ã„         |
| PyPy      | JIT           | ã»ã¼100%     | å®Ÿè¡Œæ™‚æœ€é©åŒ–         |
| **Codon** | **AOTï¼ˆLLVMï¼‰** | **90ã€œ95%** | é™çš„å‹+é«˜é€Ÿãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ |

Codon ã®æ€æƒ³ã¯ã€ŒPythonã®æ›¸ãã‚„ã™ã•ã€ã¨ã€ŒCã®é€Ÿã•ã€ã‚’ä¸¡ç«‹ã™ã‚‹ã“ã¨ã€‚
**Pythonã®æ–‡æ³•ã®ã¾ã¾ã€ãƒã‚¤ãƒ†ã‚£ãƒ–å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ãã‚‹** ã®ãŒæœ€å¤§ã®é­…åŠ›ã§ã™ã€‚

* Codon ã®æ¦‚è¦
* ã€ŒPython ã‚’ LLVM ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã€ã¨ã„ã†æ€æƒ³
* JIT ã¨ AOTï¼ˆAhead of Timeï¼‰ã®é•ã„
* PyPy ã‚„ Cython ã¨ã®ä½ç½®ã¥ã‘ã®æ¯”è¼ƒ
* ãªãœ Codon ã¯é«˜é€Ÿãªã®ã‹ï¼ˆLLVM IR â†’ ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ï¼‰
* Python æ§‹æ–‡ã¨ã®äº’æ›æ€§ãƒ»åˆ¶é™


---

## âš¡ ç¬¬2ç« ï¼šãªãœCodonãªã®ã‹

* **Pythonã®ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ï¼ˆé–¢æ•°å‘¼ã³å‡ºã—ãƒ»å‹åˆ¤å®šãƒ»GCï¼‰** ã‚’LLVMãŒé™¤å»ã€‚
* `def` ã®ã¾ã¾æœ€é©åŒ–ã•ã‚Œã€JITã‚ˆã‚Šå®‰å®šã—ãŸæ€§èƒ½ã‚’ç™ºæ®ã€‚
* ç‰¹ã«å†å¸°æ§‹é€ ãƒ»æ¢ç´¢ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ï¼ˆN-Queensãªã©ï¼‰ã§åœ§å€’çš„ã«é€Ÿã„ã€‚
* **ç§»æ¤ãŒå®¹æ˜“**ï¼šã»ã¨ã‚“ã©ã®Pythonã‚³ãƒ¼ãƒ‰ãŒCodonã§ãã®ã¾ã¾å‹•ä½œã€‚
* **C++ã«åŒ¹æ•µã™ã‚‹é€Ÿåº¦**ã‚’ã€Pythonã®å¯èª­æ€§ã®ã¾ã¾é”æˆå¯èƒ½ã€‚

> [!TIP]
> Codonã¯ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãªã—ã§ Pythonã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ãªãƒã‚·ãƒ³èªã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹é«˜æ€§èƒ½ãªPythonã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã™ã€‚ Codonã‚’ä½¿ã†ã¨ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚ååˆ†ãªé«˜é€ŸåŒ–ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ãŒã€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã‚‚ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ãŸã‚ã€æ›´ãªã‚‹é«˜é€ŸåŒ–ã‚‚å›³ã‚Œã¾ã™ã€‚


---

## ğŸ§± ç¬¬3ç« ï¼šCodonç’°å¢ƒæ§‹ç¯‰ï¼ˆFedora / Amazon Linuxï¼‰

### 3.0 Linux/macã§ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
```bash
/bin/bash -c "$(curl -fsSL https://exaloop.io/install.sh)"
```

> [!TIP]
> OSãŒLinux (x86_64) ã‹ MacOS (x86_64 ã¾ãŸã¯ arm64) ã§ã‚ã‚Œã°ã€å…¬å¼ã‹ã‚‰ãƒ“ãƒ«ãƒ‰æ¸ˆã¿ã®ãƒã‚¤ãƒŠãƒªãŒé…å¸ƒã•ã‚Œã¦ã„ã‚‹ã®ã§ã€1ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

* Python ã®æŸ”è»Ÿã•ã¨é…ã•ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•
* Codon ã«ã‚ˆã‚‹é«˜é€ŸåŒ–ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
* Python ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ã€Œãƒ“ãƒ«ãƒ‰ã€ã§ãã‚‹åˆ©ç‚¹
* `codon build` / `codon run` / `codon repl` ã®é•ã„
* Codon ãŒå¾—æ„ã¨ã™ã‚‹é ˜åŸŸï¼ˆæ•°å€¤è¨ˆç®—ã€å†å¸°ã€ãƒãƒƒã‚¯ãƒˆãƒ©ãƒƒã‚¯ãªã©ï¼‰

### 3.1 ã‚½ãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰æ‰‹é †ï¼ˆå†ç¾æ€§ã‚ã‚Šï¼‰
ã©ã†ã—ã¦ã‚‚ã¨è¨€ã†äººã¯ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ“ãƒ«ãƒ‰ã—ã¦ä¸‹ã•ã„ã€‚
```bash
$ git clone https://github.com/exaloop/codon
$ cd codon
$ mkdir build && cd build
$ cmake .. -DCMAKE_BUILD_TYPE=Release
$ make -j$(nproc)
$ sudo make install
```

* `codon` ã‚½ãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰æ‰‹é †
* `build/_deps` ä»¥ä¸‹ã®æ§‹æˆ
* `libcodonrt.so` ã®å ´æ‰€ã¨ãƒªãƒ³ã‚¯è¨­å®š
* `codon build -release` ã¨ `codon run -release` ã®é•ã„
* `LD_LIBRARY_PATH` ã‚„ `PATH` è¨­å®šã®æ³¨æ„ç‚¹

### 3.2 ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```
cmake, ninja, fmt, toml, libomp, fast_float, semver, peglib
```

* `libdevice.10.bc` ã®å½¹å‰²
* `-libdevice` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®æ„å‘³
* NVRTC ã‚„ libcodonrt.so ã«ãŠã‘ã‚‹ `seq_nvptx_memcpy_h2d/d2h` ã®æ¬ è½
* `nm` ã‚³ãƒãƒ³ãƒ‰ã§ã®ã‚·ãƒ³ãƒœãƒ«ç¢ºèªä¾‹
* GPU ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ãŒæœªå®Œã«çµ‚ã‚ã£ãŸç†ç”±ã¨ä»Šå¾Œã®å±•æœ›

### 3.3 ãƒ©ãƒ³ã‚¿ã‚¤ãƒ è¨­å®š

```bash
export PATH=/usr/local/codon/bin:$PATH
export LD_LIBRARY_PATH=/usr/local/codon/lib:$LD_LIBRARY_PATH
```

### 3.4 å®Ÿè¡Œ
JIT(Just-In-Time)ã§å®Ÿè¡Œï¼ˆé…ã„ã‘ã©ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã›ãšã«å®Ÿè¡Œ)
```bash
$ codon run hello.py
Hello Codon!
```

ãƒ“ãƒ«ãƒ‰ã—ã¦å®Ÿè¡Œï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹ã‹ã‚‰è¶…é«˜é€Ÿï¼‰
```bash
$ codon build -release hello.py && ./hello
Hello Codon!
```
---

### 3.5 è¨ˆæ¸¬

è¨€èªã«ã‚ˆã‚‹é€Ÿåº¦æ¯”è¼ƒ
| åå‰ | å‡¦ç†æ™‚é–“ (s) | é€Ÿåº¦ (CPython æ¯”) | é †ä½ |
|------|---------------|-------------------|------|
| Python | 8.40 | 1.00 | 8 |
| PyPy | 2.08 | 4.03 | 7 |
| Cython | 0.373 | 22.5 | 6 |
| Numba | 0.155 | 54.3 | 5 |
| C++ | 0.138 | 60.7 | 4 |
| Nim | 0.0359 | 234 | 3 |
| MojoğŸ”¥ | 0.0289 | 291 | 2 |
| Codon | 0.0281 | 299 | 1 |


ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã«ã‚ˆã‚‹é€Ÿåº¦æ¯”è¼ƒ
| å®Ÿè¡Œæ–¹æ³• | å‡¦ç†æ™‚é–“ï¼ˆç§’ï¼‰ |
|-----------|------------------------------|
| é€šå¸¸ã®Python (Liståˆ©ç”¨) | 9.71 |
| Codon (Liståˆ©ç”¨) | 1.04 |
| Codon (é™çš„é…åˆ—åˆ©ç”¨) | 0.27 |
| Codon (Liståˆ©ç”¨) æœ€é©åŒ–ã‚ã‚Š | 0.05 |
| Codon (é™çš„é…åˆ—åˆ©ç”¨) æœ€é©åŒ–ã‚ã‚Š | 0.04 |

> [!TIP]
> Codonã¯Pythonã‚³ãƒ¼ãƒ‰ã‚’é«˜é€ŸåŒ–ã™ã‚‹ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ã§ã€é€šå¸¸ã®Pythonã¨æ¯”è¼ƒã—ã¦10å€ã‹ã‚‰100å€ã€C/C++ã«åŒ¹æ•µã™ã‚‹é€Ÿåº¦ã‚’å®Ÿç¾ã—ã¾ã™ã€‚ã“ã‚Œã¯ã€å®Ÿè¡Œå‰ã«å‹ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã€ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒã‚·ãƒ³ã‚³ãƒ¼ãƒ‰ã«ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã“ã¨ã§ã€Pythonã®å®Ÿè¡Œæ™‚ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ã‚’å›é¿ã™ã‚‹ãŸã‚ã§ã™ã€‚ã¾ãŸã€ä¸¦åˆ—å‡¦ç†ã«ã‚‚å¯¾å¿œã—ã€ã•ã‚‰ãªã‚‹é€Ÿåº¦å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™



## ğŸ§  ç¬¬4ç« ï¼šCodonã®é«˜é€ŸåŒ–åŸç†ã¨åŸºæœ¬æ§‹æ–‡

Codon ã¯å‹ã‚’å›ºå®šã™ã‚‹ã“ã¨ã§ã€å‹•çš„å‹åˆ¤å®šã‚’ã™ã¹ã¦æ’é™¤ã—ã¾ã™ã€‚

### åŸºæœ¬çš„ãªæ›¸ãæ–¹

```python
from typing import List

def fib(n: int) -> int:
    if n < 2:
        return n
    return fib(n - 1) + fib(n - 2)

print(fib(40))
```

* å¤‰æ•°å‹ã®æ˜ç¤º (`int`, `List[int]`, `Dict[int,int]`) ã®é‡è¦æ€§
* å†å¸°é–¢æ•°ã®å‘¼ã³å‡ºã—ã‚³ã‚¹ãƒˆå‰Šæ¸›
* `for` ãƒ«ãƒ¼ãƒ—ã¨ `while` ãƒ«ãƒ¼ãƒ—ã®æœ€é©åŒ–æŒ™å‹•
* é…åˆ—ãƒ»è¾æ›¸ã®é™çš„ç¢ºä¿
* `@codon.jit`, `@codon.inline` ãªã©ã®ä½¿ç”¨å¯å¦ã¨å®Ÿé¨“çµæœ
* Python ã¨ Codon ã§ã®æ•´æ•°ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼æŒ™å‹•ã®é•ã„
* `bit` / `mask` æ¼”ç®—ã§ã®é«˜é€ŸåŒ–ä¾‹

### æœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆ

* å‹ãƒ’ãƒ³ãƒˆã‚’**ã™ã¹ã¦æ˜ç¤º**ã™ã‚‹ (`int`, `List[int]`, `Dict[str,int]`ãªã©)
* ä¾‹å¤– (`try/except`) ã‚’ä½¿ã‚ãªã„
* ãƒ«ãƒ¼ãƒ—å¤–ã§ãƒ¡ãƒ¢ãƒªã‚’ç¢ºä¿ã—å†åˆ©ç”¨
* `while` ãƒ«ãƒ¼ãƒ—ã‚’å¤šç”¨ã—ã€å†å¸°ã‚’éšå±¤çš„ã«ç½®ãæ›ãˆã‚‹
* ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚„å‹•çš„ import ã‚’é¿ã‘ã‚‹

---

## â™Ÿï¸ ç¬¬5ç« ï¼šN-Queensã‚½ãƒ«ãƒãƒ¼ã®Codonå®Ÿè£…

ç§ã¯ N-Queens å•é¡Œã‚’ Codon ã§å®Œå…¨å®Ÿè£…ã—ã€
**Python æ¯” ç´„8ã€œ15å€** ã®é«˜é€ŸåŒ–ã‚’ç¢ºèªã—ã¾ã—ãŸã€‚

* bitæ¼”ç®—ã«ã‚ˆã‚‹ãƒãƒƒã‚¯ãƒˆãƒ©ãƒƒã‚¯æœ€é©åŒ–
* å¯¾ç§°æ€§é™¤å»ï¼ˆmirror / rotation / canonicalï¼‰
* `constellation` æ‰‹æ³•ã®å°å…¥ï¼ˆéƒ¨åˆ†ç›¤é¢ãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰
* `blocked_next`, `next_free`, `board_mask` ã®æ¦‚å¿µ
* é–¢æ•°åˆ†å‰²ã¨ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
* é…åˆ—ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ•´æ•°ã«ç½®æ›
* `List[Dict[str,int]]` ã‚’ `struct` ç›¸å½“è¡¨ç¾ã«å¤‰æ›
* `COUNT2/4/8` ã®åˆ†é›¢ã«ã‚ˆã‚‹å†å¸°æœ¨ã®ç°¡ç•¥åŒ–
* Codon ç‰ˆã§ã® `SQ_core_unified()` å®Ÿè£…ã®å…¨ä½“åƒ
* Codon ã«ã‚ˆã‚‹é€Ÿåº¦å‘ä¸Šï¼ˆPython æ¯” Ã—8ã€œÃ—15ï¼‰

### 5.1 ä¸»ãªæœ€é©åŒ–æ‰‹æ³•

* **ãƒ“ãƒƒãƒˆãƒœãƒ¼ãƒ‰** ã«ã‚ˆã‚‹è¡çªåˆ¤å®š
* **å¯¾ç§°æ€§é™¤å»**ï¼ˆmirror / rotationï¼‰
* **Constellationæ³•**ï¼ˆéƒ¨åˆ†ç›¤é¢ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ã‚ˆã‚‹åˆ†å‰²æ¢ç´¢ï¼‰
* **blocked_next**ï¼**next_free** ã«ã‚ˆã‚‹æ—©æœŸæåˆˆã‚Š
* **Zobrist Hash** ã«ã‚ˆã‚‹æ¢ç´¢é‡è¤‡æ’é™¤
* **canonicalåŒ–ãƒã‚§ãƒƒã‚¯** ã«ã‚ˆã‚‹ä¸€æ„è§£æŠ½å‡º

### 5.2 ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœï¼ˆFedora42 / Codon v0.17ï¼‰

| N  | Total   | Unique |  Python  |  pypy  | Codon  | GPU/CUDA |
| -- | ------- | ------ | -------- | ------ | ------ | -------- |
| 8  | 92      | 12     |  00.126s | 0.169s | 0.001s |   0.01   |
| 13 | 73712   | 9233   |  00.355s | 0.825s | 0.005s |   0.04   |
| 15 | 2279184 | 285053 |  09.006s | 3.841s | 0.035s |   0.07   |
| 17 |14772512 |11977939|1:07.235s |13.367s | 0.436s |   0.26   |

---

## ğŸ”© ç¬¬6ç« ï¼šCodon Ã— LLVM Ã— CUDA ã¸ã®æŒ‘æˆ¦

Codon ã«ã¯ `NVPTX` ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆCUDAã‚³ãƒ¼ãƒ‰ç”Ÿæˆï¼‰ãŒå­˜åœ¨ã—ã¾ã™ãŒã€
ç¾è¡Œï¼ˆ2025æ™‚ç‚¹ï¼‰ã§ã¯æœªå®Œæˆã®éƒ¨åˆ†ãŒã‚ã‚Šã¾ã™ã€‚

### å®Ÿé¨“ä¾‹

```bash
LIBDEVICE=/usr/local/cuda/nvvm/libdevice/libdevice.10.bc
codon run -release -libdevice "$LIBDEVICE" codonCupyTest.py
```

```python
import gpu

@gpu.kernel
def hello(a, b, c):
    i = gpu.thread.x
    c[i] = a[i] + b[i]
```

çµæœï¼šCPUç‰ˆã¯å‹•ä½œã€GPUå‘¼ã³å‡ºã—ã¯ `seq_nvptx_memcpy_h2d/d2h` æ¬ è½ã«ã‚ˆã‚Šæœªå®Œã€‚
â†’ Codon ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã® NVPTX ã‚µãƒãƒ¼ãƒˆå†æ§‹ç¯‰ãŒä»Šå¾Œã®èª²é¡Œã€‚

* Codon ã® LLVM ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è§£æ
* NVPTX ç”Ÿæˆã«å¿…è¦ãª `seq_nvptx_*` ã‚·ãƒ³ãƒœãƒ«ç¾¤
* `codon run -release -libdevice` å®Ÿé¨“çµæœ
* GPU ã‚«ãƒ¼ãƒãƒ«ä¿®æ­£ä¾‹ï¼ˆ`@gpu.kernel` ã®å‹•ä½œç¢ºèªï¼‰
* å°†æ¥ã® GPU çµ±åˆã®æ–¹å‘æ€§
* Python â†” Codon â†” CUDA ã®é€£æºãƒ¢ãƒ‡ãƒ«æ§‹æƒ³å›³

`
---

## ğŸ§­ ç¬¬7ç« ï¼šã§ããŸã“ã¨ï¼ã§ããªã‹ã£ãŸã“ã¨

| é …ç›®                   | çŠ¶æ³                    | å‚™è€ƒ                 |
| -------------------- | --------------------- | ------------------ |
| Codon ãƒ“ãƒ«ãƒ‰            | âœ… å®Œäº†ï¼ˆFedora / AL2023ï¼‰ | å†ç¾æ€§ã‚ã‚Š              |
| N-Queens CPUç‰ˆ        | âœ… å®Œæˆï¼é«˜é€ŸåŒ–æˆåŠŸ            | PyPyæ¯” Ã—10ã€œ15       |
| GPUç‰ˆ Codon å®Ÿé¨“        | âš ï¸ æœªå®Œ                 | NVPTX ã‚·ãƒ³ãƒœãƒ«æ¬ è½       |
| LLVM IR è§£æ           | âœ… æˆåŠŸ                  | `opt` / `llc` ã§ç¢ºèª  |
| ä¸¦åˆ—åŒ–ï¼ˆmultiprocessingï¼‰ | âœ… å®Ÿè£…æ¸ˆ                 | Codonæ¨™æº–ä¸¦åˆ—åŒ–ã¯æœªæ­è¼‰     |
| Canonicalåˆ¤å®š          | âœ… å®Ÿè£…æ¸ˆ                 | `jasmin()` ã«ã‚ˆã‚‹é‡è¤‡é™¤å» |
| NVRTC çµ±åˆ             | âš ï¸ è©¦é¨“æ®µéš               | CUDAçµ„è¾¼ã¿æœªå®‰å®š         |

---

## ğŸ”§ ç¬¬8ç« ï¼šæ§‹ç¯‰ãƒ»é–‹ç™ºãƒã‚¦ãƒã‚¦

* Codon ãƒ“ãƒ«ãƒ‰æ™‚ã« `ninja -v` ã§è©³ç´°ç¢ºèª
* `libcodonrt.so` ã®ä½ç½®ã‚’ `nm -D` ã§ç¢ºèª
* Pythonã‚³ãƒ¼ãƒ‰ã‚’ã€Œæ®µéšçš„ã« Codon ã«ç½®ãæ›ãˆã‚‹ã€æ–¹é‡ãŒæœ‰åŠ¹
* å‹ãƒ’ãƒ³ãƒˆã‚’çœç•¥ã—ãªã„
* å†å¸°â†’åå¾©åŒ–ã‚’æ„è­˜
* ä¾‹å¤–ã‚ˆã‚Šæˆ»ã‚Šå€¤åˆ¶å¾¡
* å¤§è¦æ¨¡æ¢ç´¢ã§ã¯ `print` ãƒ‡ãƒãƒƒã‚°ã‚’é¿ã‘ã€çµæœã ã‘å‡ºåŠ›
* ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã¾ãš `ninja -v` å‡ºåŠ›ã§åŸå› ã‚’æ¢ã™
* `fmt` / `toml` / `semver` / `fast_float` ã®çµ„ã¿è¾¼ã¿ä¾å­˜
* `type: ignore` ã‚’å¤–ã™
* è¨ˆç®—ãƒ«ãƒ¼ãƒ—å†…ã§ã¯ã€Œä¾‹å¤–ç™ºç”Ÿã€ã‚’çµ¶å¯¾ã«é¿ã‘ã‚‹
* printãƒ‡ãƒãƒƒã‚°æ™‚ã® `str(dt)[:-3]` ã®ã‚ˆã†ãªæ›¸å¼çŸ­ç¸®

---

## ğŸ§® ç¬¬9ç« ï¼šCodonã§å­¦ã‚“ã è¨­è¨ˆæ€æƒ³

> ã€ŒCodonã«ç§»æ¤ã§ãã‚‹Pythonã‚³ãƒ¼ãƒ‰ã€ã‚’æœ€åˆã‹ã‚‰æ›¸ãã€‚

* å‹•çš„å‹ã‚’é¿ã‘ã€**å¸¸ã«é™çš„æ€è€ƒã§æ›¸ã**
* ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¾å­˜ã‚’æ¸›ã‚‰ã—ã€**æ¨™æº–æ¼”ç®—ã ã‘ã§å®Œçµ**
* å†å¸°æ·±åº¦ã‚’æ¸›ã‚‰ã—ã€**æ˜ç¤ºçš„ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†**
* ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚’ä½¿ã‚ãšã€æ§‹é€ ä½“ã‚„ã‚¯ãƒ©ã‚¹ã§å—ã‘æ¸¡ã™
* `List` ã‚ˆã‚Šå›ºå®šé•·é…åˆ—ã‚’å„ªå…ˆ
* ã€ŒCPUã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ã€ãªé…ç½®ã‚’æ„è­˜ã™ã‚‹
* Python ã‚³ãƒ¼ãƒ‰ã‚’ã€Œå¾Œã‹ã‚‰ Codon ã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹ã€è¨­è¨ˆã«ã™ã‚‹
* å‹ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å³å¯†ã«æ›¸ã
* ä¾‹å¤–ã§ã¯ãªãæˆ»ã‚Šå€¤ã§å‡¦ç†åˆ¶å¾¡
* ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå¿—å‘ã‚ˆã‚Šã‚‚æ§‹é€ ä½“å¿—å‘
* å†å¸°ã‚ˆã‚Šã‚‚åå¾©ã¸ã®ç½®æ›ã‚’æ¤œè¨
* è¨ˆç®—é‡ãŒæŒ‡æ•°çš„ãªå ´åˆã«ç‰¹ã«å¨åŠ›ã‚’ç™ºæ®ã™ã‚‹é ˜åŸŸ

---

## ğŸŒŒ ç¬¬10ç« ï¼šCodonã®æœªæ¥ã¨æ„ç¾©

Codon ã¯ã¾ã è‹¥ã„ãŒã€**Python ã®æœªæ¥ã‚’å¤‰ãˆã‚‹å¯èƒ½æ€§ã‚’æŒã¤ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©**ã§ã™ã€‚
AIãƒ»ç§‘å­¦è¨ˆç®—ãƒ»ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®Ÿé¨“ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å‡¦ç†ã®ã‚ã‚‰ã‚†ã‚‹åˆ†é‡ã§
ã€Œ**Pythonã®æ›¸ãã‚„ã™ã•ã®ã¾ã¾C++ã®é€Ÿã•**ã€ã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

ç§ãŒ N-Queens ã‚½ãƒ«ãƒãƒ¼ã‚’é€šã—ã¦å¾—ãŸç¢ºä¿¡ã¯ã“ã†ã§ã™ï¼š

> **Codon ã¯ â€œPython ã®çµ‚ç€ç‚¹â€ ã§ã¯ãªãã€â€œãƒã‚¤ãƒ†ã‚£ãƒ–åŒ–ã¸ã®æ©‹â€ ã§ã‚ã‚‹ã€‚**

* Codonã¯ã€ŒPythonã®çµ‚ç€ç‚¹ã€ã§ã¯ãªãã€Œãƒã‚¤ãƒ†ã‚£ãƒ–åŒ–ã®æ©‹ã€
* Codonã‚’çŸ¥ã‚‹ã¨ã€Pythonã‚³ãƒ¼ãƒ‰ã®æ›¸ãæ–¹è‡ªä½“ãŒå¤‰ã‚ã‚‹
* ç¾æ™‚ç‚¹ã§ã®åˆ¶ç´„ï¼šæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ¶é™ã€å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé€£æºã®é›£ã—ã•
* å°†æ¥çš„ã«æœŸå¾…ã•ã‚Œã‚‹æ–¹å‘ï¼šGPUçµ±åˆã€NumPyå¯¾å¿œã€RAG/AIç³»é€£æº
* å®Ÿè·µçš„æ¨å¥¨æ§‹æˆï¼ˆFedora42 + Codon v0.17 + Python3.13 + LLVM17ï¼‰

---

## ğŸ§¾ Appendix: æˆæœã®è¦ç´„

* Constellationæ³• + Codon æœ€é©åŒ–ã§ CPUç‰ˆãŒ GPUç‰ˆã‚’è¶…ãˆã‚‹é€Ÿåº¦
* æ­£ã—ã„è§£æ•°ï¼ˆN=8â†’92, N=13â†’73712ï¼‰ã‚’å®Œå…¨å†ç¾
* Amazon Linux 2023 + LLVM17 + Codon0.17 ç’°å¢ƒã§å†ç¾å¯èƒ½
* Fedora42 ã§å®‰å®šç¨¼åƒï¼å†å¸°ãƒ»å†åˆ©ç”¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥å®Œå…¨å¯¾å¿œ
* CodonãŒã€Œé«˜é€ŸPythonå®Ÿé¨“ã€ã®æ¨™æº–åŸºç›¤ã«ãªã‚‹å¯èƒ½æ€§ã‚’å®Ÿè¨¼
* CPUç‰ˆã§CUDAç‰ˆã‚’ä¸Šå›ã‚‹æ€§èƒ½ã‚’ç¢ºèªï¼ˆç´„1.2å€ï¼‰
* Symmetry-aware pruning ã¨ Canonical check ã«ã‚ˆã‚‹æ•°å­¦çš„æ­£ç¢ºæ€§
* Codonç‰ˆã‚½ãƒ«ãƒãƒ¼ãŒå†ç¾ã—ãŸå…¬å¼è§£æ•°ï¼ˆN=8â†’92, N=13â†’73,712ãªã©ï¼‰
* Amazon Linux 2023 ç’°å¢ƒä¸‹ã§ã® reproducible benchmark log

---

## ğŸ“š é–¢é€£ãƒªãƒ³ã‚¯

* [Codon GitHub (Exaloop)](https://github.com/exaloop/codon)
* [N-Queens Project Archive](https://github.com/suzukiiichiro/N-Queens)
* [å…¬å¼ LLVM Documentation](https://llvm.org/docs/)
* [Codon Language Docs](https://docs.exaloop.io)

---

## ğŸ§‘â€ğŸ’» çµã³ã«

ã“ã“ã«è¨˜ã—ãŸå†…å®¹ã¯ã€å˜ãªã‚‹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯çµæœã®ç¾…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
Python ã®é™ç•Œã‚’çŸ¥ã‚Šã€Codon ã®è¨­è¨ˆæ€æƒ³ã‚’ç†è§£ã—ã€
**ã€Œæ›¸ãæ–¹ãã®ã‚‚ã®ã‚’å¤‰ãˆã‚‹ã€ã“ã¨ã§é€Ÿã•ã‚’å¾—ã‚‹** ã¨ã„ã†æ€æƒ³ã®è¨˜éŒ²ã§ã™ã€‚

> *â€œCodon is not just a compiler.
> Itâ€™s a mindset shift for Python programmers.â€*

---

### âœ¨ License

MIT License â€” Â© 2025 iichiro suzuki
