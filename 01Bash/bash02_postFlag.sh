#!/bin/bash
#
#
# Bash（シェルスクリプト）で学ぶ「アルゴリズムとデータ構造」
# 一般社団法人  共同通信社  情報技術局  鈴木  維一郎(suzuki.iichiro@kyodonews.jp)
#
# ---------------------------------------------------------------------------------
##
# ２．配置フラグ（制約テスト高速化）
#  パターンを生成し終わってからチェックを行うのではなく、途中で制約を満たさな
#  い事が明らかな場合は、それ以降のパターン生成を行わない。
# 「手を進められるだけ進めて、それ以上は無理（それ以上進めても解はない）という
# 事がわかると一手だけ戻ってやり直す」という考え方で全ての手を調べる方法。
# (※)各行列に一個の王妃配置する組み合わせを再帰的に列挙分枝走査を行っても、組
# み合わせを列挙するだけであって、8王妃問題を解いているわけではありません。
#
# ---------------------------------------------------------------------------------
#
#  N-Queen の データ配列について
#  =============================
#
#  総当たり
#  結局全部のケースをやってみる（完全解）
#
#  バックトラック
#  とりあえずやってみる。ダメなら戻って別の道を探る
#
#
#  N-Queen: クイーンの効き筋
#  =========================
#  クイーンの位置から、縦、横、斜めが効き筋となります。
#
#  　　       column(列)
#  row(行)_0___1___2___3___4_
#       0|-*-|---|---|-*-|---|
#        +-------------------+
#       1|---|-*-|---|-*-|---|
#        +-------------------+ 
#       2|---|---|-*-|-*-|-*-| 
#        +-------------------+ 
#       3|-*-|-*-|-*-|-Q-|-*-|
#        +-------------------+
#       4|---|---|-*-|-*-|-*-|
#        +-------------------+
#
#
#  N-Queen: 盤面上で互いのクイーンが効き筋にならないように配置
#  ===========================================================
#
#        完成図は以下の通りです。
#
#  　　       column(列)
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---|
#        +-------------------+
#       1|---|---|---|-Q-|---|
#        +-------------------+ 
#       2|---|-Q-|---|---|---| 
#        +-------------------+ 
#       3|---|---|---|---|-Q-|
#        +-------------------+
#       4|---|---|-Q-|---|---|
#        +-------------------+
#
#
#  効き筋の表現
#  ============
#
#  クイーンの位置から下側を走査対象とします。
#
#  　すでに効き筋：FALSE(盤面ではF）
#  　配置可能    ：TRUE
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|---|---|---|---|---| 
#        +-------------------+
#       1|---|---|---|---|---|
#        +-------------------+ 
#       2|---|-Q-|---|---|---| 
#        +-------------------+ 
#       3|-F-|-F-|-F-|---|---|
#        +-------------------+
#       4|---|-F-|---|-F-|---|
#        +-------------------+
#                      
#
#  効き筋を三つの配列で表現
#  ========================
#
#  ■ 基本：aBoard[row]=col
#           aBoard[2  ]=1
#
#  　　       column(列)
#  row(行)_0___1___2___3___4_
#       0|---|---|---|---|---|
#        +-------------------+
#       1|---|---|---|---|---|
#        +-------------------+ 
#       2|---|-Q-|---|---|---| aBoard[2]=1 に配置
#        +-------------------+
#       3|---|---|---|---|---|
#        +-------------------+
#       4|---|---|---|---|---|
#        +-------------------+
#
#
#  ■配列1：down[row]
#
#  そのrow(行)にQueenがいる場合はFALSE
#                      いない場合はTRUE
#
#  　　       column(列)
#  row(行)_0___1___2___3___4_
#       0|---|---|---|---|---|
#        +-------------------+
#       1|---|---|---|---|---|
#        +-------------------+ 
#       2|---|-Q-|---|---|---| 
#        +-------------------+
#       3|---|-F-|---|---|---|
#        +-------------------+
#       4|---|-F-|---|---|---|
#        +-------------------+
#             down[col(1)]==false (すでに効き筋）
#
#
#  ■配列２：right[col-row+N-1]
#                    right[col-row+N-1]==F
#                        Qの場所：col(1)-row(2)+(4-1)=2なので
#                        col-row+N-1が２のところがＦとなる 
#  　　       column(列)
#  row(行)_0___1___2___3___4_
#       0|---|---|---|---|---|
#        +-------------------+
#       1|---|---|---|---|---|
#        +-------------------+ 
#       2|---|-Q-|---|---|---| 
#        +-------------------+ 
#       3|---|---|-F-|---|---|
#        +-------------------+
#       4|---|---|---|-F-|---|
#        +-------------------+
#                      right[col-row+(N-1)]==false(すでに効き筋）
#
#
#  ■配列3：left[col+row]
#                      left[col+row]==F 
#                          Qの場所：col(1)+row(2)=3なので
#                          col+rowが3になるところがFとなる。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|---|---|---|---|---|
#        +-------------------+
#       1|---|---|---|---|---|
#        +-------------------+ 
#       2|---|-Q-|---|---|---| 
#        +-------------------+ 
#       3|-F-|---|---|---|---|
#        +-------------------+
#       4|---|---|---|---|---|
#        +-------------------+
#      left[col+row]
#
#
#  ステップ１
#  ==========
#  row=0, col=0 にクイーンを配置してみます。
#
#  aBoard[row]=col
#     ↓
#  aBoard[0]=0;
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#   ->  0|-Q-|---|---|---|---| aBoard[row]=col
#        +-------------------+ aBoard[0  ]=0  
#       1|---|---|---|---|---|
#        +-------------------+ 
#       2|---|---|---|---|---| 
#        +-------------------+ 
#       3|---|---|---|---|---|
#        +-------------------+
#       4|---|---|---|---|---|
#        +-------------------+
#
#
#  考え方：２
#  ==========
#  効き筋を埋めます
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#   ->  0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|---|---|---|
#        +-------------------+ left はありません
#       2|-F-|---|-F-|---|---| 
#        +-------------------+ 
#       3|-F-|---|---|-F-|---|
#        +-------------------+
#       4|-F-|---|---|---|-F-|
#        +-------------------+
#        down[col]      right[col-row+(N-1)]
#
#
#  考え方：３
#  ==========
#  rowが一つ下に降りて０から１となります。
#  次の候補は以下のＡ，Ｂ，Ｃとなります
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#   ->  1|-F-|-F-|-A-|-B-|-C-|
#        +-------------------+ 
#       2|-F-|---|-F-|---|---| 
#        +-------------------+ 
#       3|-F-|---|---|-F-|---|
#        +-------------------+
#       4|-F-|---|---|---|-F-|
#        +-------------------+
#
#  考え方：４
#  ==========
#  Ａにおいてみます。
#  効き筋は以下の通りです。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#   ->  1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#       2|-F-|-F-|-F-|-F-|---| 
#        +-------------------+ 
#       3|-F-|---|-F-|-F-|-F-| right[col-row+(N-q)]
#        +-------------------+
#       4|-F-|---|-F-|---|-F-|
#        +-------------------+
#  left[col+row]  down[col]
#
#
#  考え方：５
#  ==========
#  rowが一つ下に降りて１から２となります。
#  次の候補はＡとなります
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#   ->  2|-F-|-F-|-F-|-F-|-A-| 
#        +-------------------+ 
#       3|-F-|---|-F-|-F-|-F-| 
#        +-------------------+
#       4|-F-|---|-F-|---|-F-|
#        +-------------------+
#
#  考え方：６
#  ==========
#  効き筋は以下の通りです。
#  特に加わるところはありません。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#   ->  2|-F-|-F-|-F-|-F-|-Q-| 
#        +-------------------+ 
#       3|-F-|---|-F-|-F-|-F-| 
#        +-------------------+
#       4|-F-|---|-F-|---|-F-|
#        +-------------------+
#
#  考え方：７
#  ==========
#  rowが一つ下に降りて２から３となります。
#  次の候補はＡとなります
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#       2|-F-|-F-|-F-|-F-|-Q-| 
#        +-------------------+ 
#   ->  3|-F-|-A-|-F-|-F-|-F-| 
#        +-------------------+
#       4|-F-|---|-F-|---|-F-|
#        +-------------------+
#
#
#  考え方：８
#  ==========
#  効き筋は以下の通りです。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#       2|-F-|-F-|-F-|-F-|-Q-| 
#        +-------------------+ 
#   ->  3|-F-|-Q-|-F-|-F-|-F-| 
#        +-------------------+
#       4|-F-|-F-|-F-|---|-F-|
#        +-------------------+
#
#
#  考え方：９
#  ==========
#  今回は、うまくいっていますが、
#  次の候補がなければ、キャンセルして、
#  前のコマを次の候補にコマを移動し、
#  処理を継続します。
#
#
#  考え方：１０
#  =========-=
#
#  rowが一つ下に降りて３から４となります。
#  候補はのこり１箇所しかありません。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#       2|-F-|-F-|-F-|-F-|-Q-| 
#        +-------------------+ 
#       3|-F-|-Q-|-F-|-F-|-F-| 
#        +-------------------+
#   ->  4|-F-|-F-|-F-|-A-|-F-|
#        +-------------------+
#
#
#
#  考え方：１１
#  ==========
#  最後のクイーンをおきます
#  columnの最終列は効き筋を確認する必要はありませんね。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---| 
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|
#        +-------------------+ 
#       2|-F-|-F-|-F-|-F-|-Q-| 
#        +-------------------+ 
#       3|-F-|-Q-|-F-|-F-|-F-| 
#        +-------------------+
#   ->  4|-F-|-F-|-F-|-Q-|-F-|
#        +-------------------+
#
#  考え方：１２
#  ==========
#  rowの脇にcolの位置を示します。
#
#  　　       column(列) 
#  row(行)_0___1___2___3___4_
#       0|-Q-|---|---|---|---|  [0]
#        +-------------------+ 
#       1|-F-|-F-|-Q-|---|---|  [2]
#        +-------------------+ 
#       2|-F-|-F-|-F-|-F-|-Q-|  [4]
#        +-------------------+ 
#       3|-F-|-Q-|-F-|-F-|-F-|  [1]
#        +-------------------+
#   ->  4|-F-|-F-|-F-|-Q-|-F-|  [3]
#        +-------------------+
#
#
#  考え方：１３
#  ==========
#
#  ボード配列は以下のように表します。
#  aBoard[]={0,2,4,1,3]
#
#  出力：
#    1: 0 0 0 1
#    2: 0 0 0 2
#    3: 0 0 0 4
#    :
#    :
#
#
#
#
# 実行結果
#  :
#  :
#  40313: 7 6 5 4 2 3 0 1
#  40314: 7 6 5 4 2 3 1 0
#  40315: 7 6 5 4 3 0 1 2
#  40316: 7 6 5 4 3 0 2 1
#  40317: 7 6 5 4 3 1 0 2
#  40318: 7 6 5 4 3 1 2 0
#  40319: 7 6 5 4 3 2 0 1
#  40320: 7 6 5 4 3 2 1 0
#
COUNT=1; # グローバル変数は大文字
#
function N-Queen2(){
  # ローカル変数は明示的に local をつけ、代入する場合は ""ダブルクォートが必要です。
  # -i は 変数の型が整数であることを示しています
  local -i min="$1";        # ひとつ目のパラメータ $1をminに代入
  local -i size="$2";       # ふたつ目のパラメータ $2をsizeに代入
  local flag_a="";
  local -i i=0;           # 再帰するために forで使う変数も宣言が必要
  local -i j=0;
  # forはこういうＣ的な書き方のほうが見やすい
  for((i=0;i<size;i++)){        # (()) の中の変数に $ は不要です 
    [ "${flag_a[i]}" != "true" ]&&{   #わかりづらいですが、この文はif文 文字列比較の場合は [ ] を使います
      pos[$min]="$i" ;          # 代入する場合、posの前には$ は不要ですが、添え字には$が必要
      ((min==(size-1)))&&{      # (()) の中の変数に $ は不要です
        echo -n "$((COUNT++)): ";     # $((COUNT++))はCOUNTのインクリメント
        for((j=0;j<size;j++)){
          echo -n "${pos[j]} " ;      # 配列変数を呼び出す場合は ${}をつけます
        }
        echo "" ;               # 改行を入れる
      }||{                      # elseのはじまり
        flag_a[$i]="true" ;     # 配列の中の添え字には $ をつけます 
        N-Queen2 "$((min+1))" "$size" ; # 再帰する場合は $((min++))ではなく $((min+1))
        flag_a[$i]="" ; 
      }
    }
  }
}
#
  echo "<>２．配置フラグ（制約テスト高速化） N-Queen2()";
  N-Queen2 0 8;
#
